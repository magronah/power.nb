---
title: "Simulation for microbiome power analysis"
date: "`r Sys.Date()`"
output: 
  rmarkdown::html_vignette:
    toc: true
    toc_depth: 2
vignette: >
  %\VignetteIndexEntry{Simulation for microbiome power analysis}
  %\VignettePackage{power.nb}
  %\VignetteEngine{knitr::rmarkdown}
---



## Introduction 


**Installation**

Install the package from GitHub using `devtools`:

```{r, eval=FALSE}
install.packages("devtools")
devtools::install_github("magronah/power.nb")
```

### Overview

This package allows you to:

- Fit statistical models to microbiome count data.

- Simulate realistic count datasets with different effect sizes.

- Test for differential abundance.

- Estimate power per taxon.

- Explore sample size and effect size sensitivity.


## Model Fitting
Use your microbiome data to fit a Gaussian mixture model:

### 1. You have data

#### Data preprocessing 

```{r, eval=FALSE}
library(power.nb)
fit <- filter()
fit
```


- Fit logmean abundance 

- Estimate log fold change using ``deseq``


 
```{r, eval=FALSE}
library(power.nb)
fit <- logmean_fit()

```


### 2. You do not have data

```{r, echo=FALSE}
library(knitr)
library(kableExtra)

# Example data (two rows like in your LaTeX version)
df <- data.frame(
  `Data description` = c("Example row 1", "Example row 2"),
  n1 = c(5, 5),
  mu1 = c("(2,3,4,5,7)", "(2,3,4,5,7)"),
  sigma1 = c("(2,3,4,5,7)", "(2,3,4,5,7)"),
  p1 = c("(2,3,4,5,7)", "(2,3,4,5,7)"),
  n2 = c(5, 5),
  mu2 = c("(2,3,4,5,7)", "(2,3,4,5,7)"),
  sigma2 = c("(2,3,4,5,7)", "(2,3,4,5,7)"),
  p2 = c("(2,3,4,5,7)", "(2,3,4,5,7)"),
  fx = c("(2,3,4,5,7)", "(2,3,4,5,7)")
)

kbl(df, booktabs = TRUE, longtable = TRUE,
    caption = "Data description and parameter estimates") %>%
  kable_styling(latex_options = c("hold_position", "repeat_header")) %>%
  add_header_above(c(" " = 1, "Log mean count" = 4, "Log foldchange" = 5)) %>%
  add_header_above(c(" " = 1, "Parameters" = 9)) # optional extra grouping

```


 

## Simulating Data


```{r, eval=FALSE}
sim <- simulate_data(fit,
                     n_taxa = 1000,
                     n_per_group = c(30, 30),
                     fold_changes = c(1.5, 2, 4),
                     nsim = 100)
```



## Estimating Power
Calculate power for each taxon as the proportion of significant detections:



## Sample Size Estimation
